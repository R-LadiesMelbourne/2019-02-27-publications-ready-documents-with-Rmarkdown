---
title: "Writing articles and reproducible documents with `bookdown`"
author: "Anna Quaglieri"
date: "21/02/2019"
output: 
  bookdown::html_document2:
    toc: yes
    theme: readable
  bookdown::pdf_document2:
    toc: yes
---

```{r setup, include=FALSE}
library(knitr)
library(png)

knitr::opts_chunk$set(echo = TRUE,warning = FALSE,message = FALSE,
                      fig.width = 5,fig.height = 5)
```


Talking `R Markdown`, probably the main distinction between writing a reproducible report of your analysis or a journal article is the journal template and layout which is often provided as a LaTeX template by the editors. In my view, if you want to write your robust and reproducible paper in R today, you are faced with two options which are listed below in order of desirability (from more desirable to less!)

# The journal you want to submit to is part of the `rticles` `R` package {-}

Have a look at the [`rticles` package](https://github.com/rstudio/rticles) to see if your journal is listed there. This package is a collaborative effort to create `Rmd` LaTeX templates for various journals.

```{r install-rticles,eval=FALSE}

install.packages("rticles")

# Or the dev version
#devtools::install_github("rstudio/rticles")

library(rticles)
```

Then, create a new `Rmd` and choose your template as in Figure \ref{fig:rticles-from-template}!

```{r rticles-from-template,fig.width=5,fig.height=5,fig.cap="Choose your `rticles` template.",fig.show="asis", echo=FALSE}
library(png)
library(grid)

img <- readPNG("figures/paper-from-template.png")
grid.raster(img)
```

The journal template will offer all the necessary examples to show you how to cross reference sections, figures, tables and equations as well as you can check the final result by knitting the document.

\newpage

Let's try an example!

# Your journal does not have an `Rmd` LaTex template. No drama: there is the fab {-} `library(bookdown)`!


```{r bookdown-documents,fig.width=7,fig.height=6, fig.cap="Types of reproducible documents that you can produce with the `bookdown` package",fig.show="asis",echo=FALSE}
include_graphics("figures/reproducible-documents.pdf")
```

All the types of documents in Figure \ref{fig:bookdown-documents} can be easily generated using the `library(bookdown)`. This package was written to allow a flexible and comprehensve environment to write books and other technical documents in `R`. Writing everyday reproducible documents or journal articles requires a very similar infrastructure and, at the end of the day, there is very little substantial difference between them. Yihui Xie wrote a super comprehensive book  https://bookdown.org/yihui/bookdown/ about writing technical documents with `R markdown`. Once you master one type of document, you are pretty well set to master them all! In my view, the three types of documents in Figure \ref{fig:bookdown-documents} are constituted by the following common parts:

1. The [YAML](https://en.wikipedia.org/wiki/YAML) which sets the layout, theme and rendering style of your document;
2. The **body** of the documents constituted by plain text/code chunks/
	figures/tables/equations and that can be divided into sections and subsections;
	
More common for books and papers:

3. A `.bib` file to include your references, even though this might be more common to books or journal articles.
4. The need to **cross-reference** sections/tables/figures that allows robustness to changes and reproducibility.

In some cases, especially for books and papers revision, you might need real-time collaboration on the same document. For this purpose I suggest looking into [Overleaf](https://www.overleaf.com/project) which allows real-time collboration with LaTex which can easily be generated by setting the `keep_tex: true` option in the document `YAML`.

As you can appreciate, probably the main requirement that makes an article a little bit more special is the theme layout of the journal. Apart from this, when I started investigating writing an article in `Rmd` I really wanted to have a robust approach that would satisfy all my needs. In particular:

* I wanted a robust way to cross-reference sections/tables/figures and that would allow, in case I needed it, the creation of a list of tables and figures. 
* I hadn't picked yet a specific journal where to submit my paper and Bioinformatics journals are not yet present into the `rticles` libraries.  
* I wanted to be able to create a file of additional information where tables and figures would be numbered distinctly from the main manuscript (e.g. S1, S2 etc...)
* Ideally, I wanted to be able to export the LaTex file to potentially add the Bioinformatics journal template that I needed.  

The `bookdown::pdf_document2` was exactly what I was looking for: I could write in `R markdown` as usual but at the same time exploiting the flexibility and robustness of `bookdown` to allow points 1 to 4 above! This is discussed in [Yihui's book](https://bookdown.org/yihui/bookdown/a-single-document.html).

In the `bookdown-article-minimal-example/` folder I created a minimal example that accomplishes all the tasks above.  


# Minimal article with `bookdown::pdf_document2:` {-}

## `YAML` setup {-}

### Allow all the robust `bookdown` cross-referencing {-}

```yaml
---
title: "A minimal paper"
author: "Anna Quaglieri"
output: 
  bookdown::pdf_document2:
    toc: no
    keep_tex: true
---
```

### Add abstract, authors and bibliography file {-}

```yaml
---
title: "A minimal paper"
author: "Anna Quaglieri"
output: 
  bookdown::pdf_document2:
    toc: no
    keep_tex: true
    
author: |
  | Author 1^[Corresponding author: email@email.com] $^1$, Author 2 $^1$, Author 3 $^2$
  | $^1$Affiliation1,  $^2$Affiliation2

abstract: |
  Your abstract goes here...

bibliography: biblio.bib

---
```

### Allow to split the article in separate files and combine them when knitting {-} `bookdown::bookdown_site`

```yaml
---
title: "A minimal paper"
author: "Anna Quaglieri"

site: bookdown::bookdown_site

output: 
  bookdown::pdf_document2:
    toc: no
    keep_tex: true
    
author: |
  | Author 1^[Corresponding author: email@email.com] $^1$, Author 2 $^1$, Author 3 $^2$
  | $^1$Affiliation1,  $^2$Affiliation2

abstract: |
  Your abstract goes here...

bibliography: biblio.bib

---
```

### Allow re-numbering of files in supplementary files {-}

I found the following LaTex code on this 
[StackOverflow thread](https://stackoverflow.com/questions/50223141/rmarkdown-bookdown-separate-figure-numbering-for-supplemental-section?rq=1)

```yaml
---
title: "A minimal paper"
author: "Anna Quaglieri"
output: 
  bookdown::pdf_document2:
    toc: no
    keep_tex: true
    
author: |
  | Author 1^[Corresponding author: email@email.com] $^1$, Author 2 $^1$, Author 3 $^2$
  | $^1$Affiliation1,  $^2$Affiliation2

abstract: |
  Your abstract goes here...

bibliography: biblio.bib

fontsize: 12pt
header-includes: 
  \usepackage{float} \floatplacement{figure}{H} 
  \newcommand{\beginsupplement}{\setcounter{table}{0}  \renewcommand{\thetable}{S\arabic{table}} \setcounter{figure}{0} \renewcommand{\thefigure}{S\arabic{figure}}}
  \usepackage{setspace}\doublespacing
  \usepackage{lineno}
  \linenumbers
---
```

## The body of your article

Now that you are setup with the YAML stucture you can start populating your manuscript with for figures, tables, equations, code and texts! In the minimal example that I created I created two separated `Rmd` files for the main manuscript and the additional files. This is because the manuscript could become really long and you might be better of splitting the two parts.  




